
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Solicitud de Informe</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f2f2f2; margin: 20px; }
  h2 { color: #333; }
  #numLineas, button { font-size: 18px; padding: 8px 12px; margin-right: 10px; }
  .linea-input { background-color: #fff; border: 2px solid #4CAF50; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 2px 2px 8px rgba(0,0,0,0.1); }
  .linea-input label { display: block; font-weight: bold; margin-top: 10px; font-size: 16px; }
  .linea-input input[type="text"], .linea-input select { font-size: 16px; padding: 8px; width: 100%; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
  .warning { color: #d8000c; background-color: #ffbaba; padding: 8px; border-radius: 5px; font-weight: bold; margin-bottom: 10px; }
  #lineasContainer { margin-top: 20px; }
  #enviarBtn { font-size: 18px; padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; }
  #enviarBtn:disabled { background-color: #9E9E9E; cursor: not-allowed; }
  #estado { margin-top: 15px; font-weight: bold; font-size: 16px; }
  #estado.success { color: green; }
  #estado.error { color: red; }
</style>
</head>
<body>

<h2>Solicitud de Informe</h2>

<p>Ingrese la cantidad de líneas para solicitar informe:</p>
<input type="number" id="numLineas" min="1" max="10" value="1">
<button onclick="generarCampos()">Generar campos</button>

<div id="lineasContainer"></div>

<button id="enviarBtn" onclick="enviar()">Enviar solicitud</button>
<div id="estado"></div>

<script>
function generarCampos() {
    const container = document.getElementById('lineasContainer');
    container.innerHTML = '';
    document.getElementById('estado').textContent = '';
    const num = parseInt(document.getElementById('numLineas').value);

    for (let i = 1; i <= num; i++) {
        const div = document.createElement('div');
        div.className = 'linea-input';

        const warning = document.createElement('p');
        warning.className = 'warning';
        warning.textContent = '¡Indique correctamente el nombre de la línea!';
        div.appendChild(warning);

        const labelNombre = document.createElement('label');
        labelNombre.textContent = `Nombre de la línea ${i}:`;
        const inputNombre = document.createElement('input');
        inputNombre.type = 'text';
        inputNombre.name = `linea${i}`;
        inputNombre.placeholder = 'Ej: Línea A';
        div.appendChild(labelNombre);
        div.appendChild(inputNombre);

        const labelFoto = document.createElement('label');
        labelFoto.textContent = 'Seleccionar foto:';
        const selectFoto = document.createElement('select');
        selectFoto.name = `foto${i}`;
        const option1 = new Option('Primera', 'primera');
        const option2 = new Option('Última', 'ultima');
        selectFoto.add(option1);
        selectFoto.add(option2);
        div.appendChild(labelFoto);
        div.appendChild(selectFoto);

        container.appendChild(div);
    }
}

async function enviar() {
    const estadoDiv = document.getElementById('estado');
    const enviarBtn = document.getElementById('enviarBtn');
    const num = parseInt(document.getElementById('numLineas').value);
    const resultados = [];

    for (let i = 1; i <= num; i++) {
        const nombre = document.querySelector(`input[name="linea${i}"]`).value.trim();
        const foto = document.querySelector(`select[name="foto${i}"]`).value;
        if (!nombre) {
            estadoDiv.textContent = `Debe indicar el nombre de la línea ${i}`;
            estadoDiv.className = 'error';
            return;
        }
        resultados.push({ nombre, foto });
    }

    enviarBtn.disabled = true;
    estadoDiv.textContent = 'Enviando solicitud...';
    estadoDiv.className = '';

    try {
        const response = await fetch('/.netlify/functions/Talher_function', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ lineas: resultados })
        });

        const result = await response.json();

        if (result.success) {
            estadoDiv.textContent = 'Solicitud enviada correctamente ✅';
            estadoDiv.className = 'success';
        } else {
            throw new Error(result.message || 'Error en la solicitud');
        }
    } catch (error) {
        estadoDiv.textContent = 'Error al enviar la solicitud ❌';
        estadoDiv.className = 'error';
        console.error(error);
    } finally {
        enviarBtn.disabled = false;
    }
}
</script>

</body>
</html>
